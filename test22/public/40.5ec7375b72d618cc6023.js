(self.webpackChunkzz_test_mat_hints=self.webpackChunkzz_test_mat_hints||[]).push([[40],{18e3:(e,t,r)=>{"use strict";r.d(t,{T:()=>o});var i=r(16304),s=r(47836),n=r(32548);class o{constructor(e){this.item=e}get shippingInfo(){return this.item.get("shippingInfo")}set shippingInfo(e){this.item.set("shippingInfo",e)}get orderStatus(){return this.item.get("orderStatus")}set orderStatus(e){this.item.set("orderStatus",e)}get order(){return this.item.get("order")}set order(e){this.item.set("order",e)}get payment(){return this.item.get("payment")}set payment(e){this.item.set("payment",e)}set paymentIntent(e){this.item.set("paymentIntent",e)}get paymentIntent(){return this.item.get("paymentIntent")}get paymentStatus(){return this.item.get("paymentStatus")}set paymentStatus(e){this.item.set("paymentStatus",e)}get ShippingInfo(){return this.item.get("ShippingInfo")}set ShippingInfo(e){this.item.set("ShippingInfo",e)}get updatedAt(){return this.item.get("updatedAt")}set updatedAt(e){this.item.set("updatedAt",e)}get id(){return this.item.id}set id(e){this.item.id=e}static createFrom(e){const t=new(s.Object.extend("CoffeeOrders"));return e.id&&(t.id=e.id),t.set("updatedAt",e.updatedAt),t.set("order",e.order),t.set("shippingInfo",e.shippingInfo),t.set("paymentStatus",e.paymentStatus),t.set("paymentIntent",e.paymentIntent),t.set("orderStatus",e.orderStatus),console.log("id in createfrom func","value.description"),o.create(t)}static create(e){return new o(e)}saveToDb(){var e=this;return(0,i.Z)(function*(){const t=yield e.item.save();return n.D.large()("are we in here",t),e.item=t,t})()}}},77040:(e,t,r)=>{"use strict";r.d(t,{E:()=>P});var i=r(16304),s=r(47836),n=r(82298),o=r(85372),a=r(693),c=r(15257),u=r(19773),d=r(88002),m=r(2590),l=r(67130),g=r(32548),h=r(73148);class p{constructor(e,t){this.isDirty=!1,this.isEmpty=!0,e?(this.currParsefile=e.parseFileCurrent??e.parseFileOriginal,this.origParsefile=e.parseFileOriginal,this.isDirty=e.isDirty,this.dirtyImg=e.dirtyImg,this.isEmpty=!this.origParsefile):t?(this.isDirty=!1,this.isEmpty=!0,this._url=t):(this.isDirty=!1,this.isEmpty=!0,this._url=void 0)}get url(){return this._url?this._url:this.isDirty&&this.dirtyImg?this.dirtyImg:this.origParsefile?this.origParsefile._url:"https://parsefiles.back4app.com/fZTnKcHmI10Bqv2avtNiRQzaxFotKVFMLTF9tR7i/22d775cdda6dbe865ba814d7900561ee_no_image-sm.jpg"}static create(e){return new p({parseFileOriginal:e,isDirty:!1,dirtyImg:void 0})}static empty(){const e=new p;return e.isEmpty=!0,e}newInstFromFileList(e){const t=new p({isDirty:this.isDirty,dirtyImg:this.dirtyImg,parseFileCurrent:this.currParsefile??void 0,parseFileOriginal:this.currParsefile??void 0});return t.insertNewImgFile(e),t}revert(){this.currParsefile&&this.currParsefile!==this.origParsefile?(this.currParsefile=this.origParsefile,this.isDirty=!1,this.dirtyImg=null):console.log("Revert Failed")}insertNewImgFile(e){let t;if(e&&0!==e.length){if(!(e instanceof FileList))throw Error("not a FileList object");{t=new s.File(e.item(0).name,e.item(0)),this.currParsefile=t,this.isDirty=!0;const r=new FileReader;r.readAsDataURL(e.item(0)),r.onload=e=>this.dirtyImg=r.result}}else t=new s.File("empty",[])}upsertToDb(e){var t=this;return(0,i.Z)(function*(){if(!t.isDirty)return t.origParsefile;if(e&&t.isDirty&&(yield s.Cloud.run("deletGGStockProductImage",{id:e})),t.currParsefile&&t.origParsefile!==t.currParsefile)try{return yield t.currParsefile.save()}catch(r){console.log("%cError",r.message)}else console.log("no changes")})()}saveOnly(){var e=this;return(0,i.Z)(function*(){try{if(e.currParsefile)return yield e.currParsefile.save()}catch(t){console.log("%cError",t.message)}return null})()}}class f{constructor(e){this.item=e,this._category="";const t=e.get("thumbImg");t&&"_url"in t?(this._thumbImgReader=h.T.createFromUrl(t._url),g.D.log("- + -")(t)):this._thumbImgReader=h.T.createEmpty()}get options(){return this.item.get("options")}set options(e){this.item.set("options",e)}get choices(){return this.item.get("choices")}set choices(e){this.item.set("choices",e)}get categories(){return this.item.get("categories")}set categories(e){this.item.set("categories",e)}get imageParseFile(){return this._imageParseFile}set imageParseFile(e){this._imageParseFile=e}get mediumImg(){return this.item.get("mediumImg")}set mediumImg(e){this.item.set("mediumImg",e)}get name(){return this.item.get("name")}set name(e){this.item.set("name",e)}get description(){return this.item.get("description")}set description(e){this.item.set("description",e),console.log("setting desc",e,this.item)}get productId(){return this.item.get("productId")}set productId(e){this.item.set("productId",e)}get id(){return this.item.id}set id(e){this.item.id=e}static create(e){return new f(e)}static createFromJson(e){const t=new(s.Object.extend("GGStockProducts")),r=new f(t);return r.id=e.id,r.productId=e.productId,r.description=e.description,r.name=e.name,r.categories=e.categories,r.choices=e.choices,r.options=e.options,r}saveImgIfDirty(){var e=this;return(0,i.Z)(function*(){try{return yield e._imageParseFile.save()}catch(t){console.log("%cError",t.message)}})()}_setThumbImg(e){this.item.set("thumbImg",e),e instanceof s.File?(this._thumbImgReader=h.T.createFromUrl(e._url),console.log("thumbImgFacade",this._thumbImgReader)):console.log("thumbImgFacade",e instanceof s.File,e)}getThumbImgUrl(){return this._thumbImgReader.url}lowestPrice(){return this.choices.reduce((e,t)=>e.price<t.price?e.price:t.price,1e10)}save(){var e=this;return(0,i.Z)(function*(){try{const t=p.create(e._imageParseFile),r=yield t.saveOnly();g.D.normal()("savedfile",r),e.item.set("thumbImg",r),yield e.item.save({useMasterKey:!0})}catch(t){console.log("Error on saving parse object",t.message)}})()}remove(){var e=this;return(0,i.Z)(function*(){try{return g.D.log("++")("prod",e.item),yield e.item.destroy({})}catch(t){g.D.normal()(t.message)}})()}get thumbImg(){return this._thumbImgReader}}var y=r(61360),I=r(18e3),_=r(37716);const v="GGStockProducts";let P=(()=>{class e{constructor(){this.cacheresults=!1,this.id=Math.round(1e3*Math.random()),this.subject=new n.t,s.serverURL="https://v69coffee.b4a.io",this._configLocalDatastore(),this.initWebhookListener()}get orderInProcess(){return this._orderInProcess}set orderInProcess(e){this._orderInProcess=e}_configLocalDatastore(){}initWebhookListener(){return(0,i.Z)(function*(){const e=new s.Query(v),t=yield e.subscribe();t.on("update",e=>g.D.log("updates ==>")("trigger update event",e)),t.on("create",e=>g.D.log("create ==>")("trigger create event",e)),t.on("enter",e=>g.D.log("Enter ==>")("trigger Enter event",e)),t.on("delete",e=>{e.unPin()})})()}_findProductItems(){var e=this;return(0,i.Z)(function*(){if(g.D.log("")("calling _findProductItems"),!e.cacheresults){let t=new s.Query(v);t.fromNetwork(),g.D.log("sdf")("result not cached");const r=yield t.find();return e.cacheresults=!0,r}const t=new s.Query(v);return g.D.log("+++")("querey from local datastore"),t.fromNetwork(),yield t.find()})()}listProductItems(){return(0,a.p)(this._findProductItems()).pipe((0,c.q)(1),(0,u.zg)(e=>(0,o.D)(e)),(0,d.U)(e=>f.create(e)),(0,m.q)())}_collateByCategory(e){const t={};e.forEach(e=>e.categories.forEach(r=>{r in t?t[r].push(e):t[r]=[e]}));const r=[];return Object.entries(t).forEach(([e,t])=>{r.push([e,t])}),r}_findCoffeeOrderItems(){return(0,i.Z)(function*(){const e=new s.Query("CoffeeOrders");return yield e.find()})()}listCoffeeOrderItems(){return(0,a.p)(this._findCoffeeOrderItems()).pipe((0,c.q)(1),(0,d.U)(e=>e.map(e=>y.m.create(e))))}findById(e){return(0,i.Z)(function*(){return new s.Query(v).get(e)})()}findPi(){return(0,i.Z)(function*(){const e=new s.Query("Payments");(yield e.equalTo("payment_intent","pi_1IVRQfFSRZP1GrxVV1YX1yxA").find()).forEach(function(){var e=(0,i.Z)(function*(e){e.set("payment_status","paid"),yield e.save()});return function(t){return e.apply(this,arguments)}}())})()}uploadImage(e){return(0,i.Z)(function*(){try{const t=new s.File(e.name??"",e,"image/webp"),r=yield t.save(),i=new(s.Object.extend("images"));return i.set("image",r),i.save()}catch(t){return t}})()}_findProductItem(e){return(0,i.Z)(function*(){const t=new s.Query(v);return yield t.get(e)})()}findOne(e){return(0,a.p)(this._findProductItem(e)).pipe((0,d.U)(e=>f.create(e)))}_listCategories(){return(0,i.Z)(function*(){const e=new s.Query(v);try{return yield e.find()}catch(t){throw t}})()}listCategories(){return(0,a.p)(this._listCategories()).pipe((0,c.q)(1),(0,u.zg)(e=>(0,o.D)(e)),(0,d.U)(e=>e.get("categories")),(0,d.U)(e=>e),(0,l.u)((e,t)=>(t.forEach(t=>e.add(t)),e),new Set),(0,d.U)(e=>Array.from(e)))}removeImage(e,t){return(0,i.Z)(function*(){return yield s.Cloud.run("IAmACloud"),null})()}deletStockProductImage(e,t){return(0,i.Z)(function*(){return yield s.Cloud.run("deletStockProductImage",{id:t})})()}postToOrders(e){return(0,i.Z)(function*(){try{const t=new(s.Object.extend("CoffeeOrders"));return t.set("name","postPaymentInitiatedToDb"),t.set("shipping_info",e.shippingInfo),t.set("order",e.basket),t.set("payment_intent",e.payment.payment_intent),t.set("payment_status",e.payment.payment_status),t.set("payment",e.payment),yield t.save(),yield s.Cloud.run("UpdatelastCoffeeOrderDatetime"),"retval"}catch(t){g.D.log("&& Error &&")(t.message)}})()}ggPostToCloudFunction(e){var t=this;return(0,i.Z)(function*(){return(yield t.postToOrders(e)).id})()}_getOrder(e){return(0,i.Z)(function*(){try{const t=new s.Query("CoffeeOrders");return yield t.get(e)}catch(t){g.D.error()(t.message,"orderId",e)}})()}getOrder(e){var t=this;return(0,i.Z)(function*(){const r=t._getOrder(e);return yield r})()}getCartOfOrder(e){var t=this;return(0,i.Z)(function*(){const r=yield t._getOrder(e);return console.log("%c order retrireved","color: orange",r),I.T.create(r)})()}ngOnDestroy(){s.Object.unPinAllObjects(),g.D.logCol({symbol:"\xb1\xb1\xb1\xb1",fontSize:"40px",color:"orange"})("on destroy")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);