(self.webpackChunkzz_test_mat_hints=self.webpackChunkzz_test_mat_hints||[]).push([[592],{94204:(t,e,s)=>{"use strict";s.d(e,{v:()=>a,B:()=>i});var r=s(37716),o=s(82298),n=(s(53431),s(92340));let a=(()=>{class t{constructor(){this._computedTotal={qty:0,total:0},this.BasketChanged=new r.vpe,this.objId=1e4*Math.random(),this._basketItems=[],this.basket=new o.t}get basketItems(){return this._basketItems}getComputedTotal(){return this._computedTotal}_retrieveCartFromLocalStorage(){const t=window.localStorage.getItem(n.N.LOCAL_STORAGE_CART_ITEMS_KEY),e=JSON.parse(t);console.log(" ::retrieveCartFromLocalStorage",e),Array.isArray(e)&&e.length>0&&(this.basketItems.push(...e),this.recompute())}_getBasket(){return{cart:this.basketItems,qty:2,...this._computedTotal}}_setBasketInLocalStorage(){if(this.basketItems&&this.basketItems.length>0){console.log("_setBasketInLocalStorage",this.basketItems[0].qty);const t=JSON.stringify(this.basketItems);window.localStorage.setItem(n.N.LOCAL_STORAGE_CART_ITEMS_KEY,t)}}add(t){const e=Array.isArray(t)?t:[t];for(const s of e){const t=i.findExisting(s,this.basketItems);-1===t?this.basketItems.unshift(s):this.basketItems[t].qty+=s.qty}this.recompute()}clear(){this.basketItems.splice(0,this.basketItems.length),this.recompute()}descriptionListDelimited(){return""}getBasketTotal(){}recompute(){this._basketItems=[...this._basketItems];const t=this._basketItems.reduce((t,e)=>(t.qty+=e.qty,t.total+=e.amount,t),{total:0,qty:0});this._computedTotal.qty=t.qty,this._computedTotal.total=Math.round(100*t.total)/100,console.log("compouted total",t),this.BasketChanged.emit(t),this._setBasketInLocalStorage(),this.basket.next(this._getBasket())}removeAt(t){t<0||this.basketItems.length<=t||(this.basketItems.splice(t,1),console.log("splicing for :",t),this.recompute())}setQty(t,e){const s=this.basketItems[e].qty;void 0!==s&&s!==t&&(this.basketItems[e].qty=t,this.recompute())}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),i=(()=>{class t{static findExisting(t,e){return e.findIndex(e=>t.productId===e.productId&&t.vId===e.vId)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},2350:(t,e,s)=>{"use strict";s.d(e,{VI:()=>_});var r=s(16304);function o(t,e,s,r){var o,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,s,r);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(a=(n<3?o(a):n>3?o(e,s,a):o(e,s))||a);return n>3&&a&&Object.defineProperty(e,s,a),a}var n=s(91841),a=s(92340),i=s(18e3),c=s(32548),m=s(37716),u=s(36026),p=s(10264),h=s(45862),d=s(77040);const l=(t,e)=>({payment_method_types:["card"],line_items:t,mode:"payment",success_url:a.N.siteUrl+"/#/order-statement/success/"+e,cancel_url:a.N.siteUrl+"/#/order-statement/cancelled/"+e});class _{constructor(t,e,s,r,o){this.appSet=t,this.http=e,this.router=s,this.orderStatementService=r,this.repo=o,this.stripe=new Stripe(a.N.stripe_pkey),this.lastSession={},this.serverUrl=a.N.ParseServerURL,this.ba4Hdr=(new n.WM).set("Content-Type","application/json").set("X-Parse-Application-Id",a.N.PARSE_APP_ID).set("X-Parse-REST-API-Key",a.N.PARSE_REST_API_KEY)}testResponse(){this.http.get(this.serverUrl+"small",{headers:this.ba4Hdr}).subscribe(console.log)}createPaymentIntent(t){return this.http.post(this.serverUrl+"create-payment-intent",t)}oneTimeCheckoutWithCheckoutSessionV2(t,e){var s=this;return(0,r.Z)(function*(){const r=s.formatLineItems(e.cart),o=l(r,"zz");return s.http.post(s.serverUrl+"create-checkout-session",o,{headers:s.ba4Hdr}).toPromise().then(r=>{const o={payment:{amount_total:r.amount_total,mode:r.mode,payment_intent:r.payment_intent,payment_status:r.payment_status,id:r.id},shippingInfo:t,basket:e};try{return s.repo.ggPostToCloudFunction(o)}catch(n){throw console.log("error throw in postToCloudFunction",n.message),n}})})()}ggOneTimeCheckout(t=!1,e,s){var o=this;return(0,r.Z)(function*(){let t,r={id:"",order:s,updatedAt:Date.now().toString(),shippingInfo:e,orderStatus:"open",paymentStatus:"unpaid"};try{t=i.T.createFrom(r);var{id:n}=yield t.saveToDb();c.D.large("STripe pay")("id",n)}catch(a){throw c.D.error()("Customer Order Save failed",a.message),a}try{const e=o.toStripeFormat(s.basketItems),r=l(e,n),a=yield o.http.post(o.serverUrl+"create-checkout-session",r,{headers:o.ba4Hdr}).toPromise();t.payment=function(t){return t?{amount_total:t.amount_total,mode:t.mode,payment_intent:t.payment_intent,payment_status:t.payment_status,id:t.id}:{amount_total:"",mode:"",payment_intent:"",payment_status:"",id:""}}(a),t.paymentIntent=t.payment.payment_intent,t.saveToDb(),o.appSet.isSkipStripePaymentPageEnabled()?o.router.navigate(["order-statement","success",t.id]):o.stripe.redirectToCheckout({sessionId:a.id})}catch(a){throw c.D.error()("Customer Order Save failed",a.message),a}})()}formatLineItems(t){const e=[];for(const s of t){const t={price_data:{currency:"gbp",unit_amount:Math.round(100*s.price),product_data:{name:`${s.description}/ ${s.name}/ ${s.size}`,images:[]}},quantity:s.qty};e.push(t)}return e}toStripeFormat(t){const e=[];for(const s of t){const t={price_data:{currency:"gbp",unit_amount:Math.round(100*s.choice.price),product_data:{name:`${s.name}/ ${s.choice.name}/ ${s.optionsDescList}`,images:[]}},quantity:s.qty};e.push(t)}return e}}function y(t){return function(e,s,r){console.log("%cDEPRECATE: "+t,"color: orange; fontSize: 23px",s,r)}}_.\u0275fac=function(t){return new(t||_)(m.LFG(u.X),m.LFG(n.eN),m.LFG(p.F0),m.LFG(h.k),m.LFG(d.E))},_.\u0275prov=m.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),o([y("oneTimeCheckoutWithCheckoutSessionV2")],_.prototype,"oneTimeCheckoutWithCheckoutSessionV2",null),o([y("formatLineItems")],_.prototype,"formatLineItems",null)},62351:(t,e,s)=>{"use strict";s.d(e,{p:()=>n});var r=s(38583),o=s(37716);let n=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[r.ez]]}),t})()},20298:(t,e,s)=>{"use strict";s.d(e,{U:()=>r});const r={receipt:"receipt",cartOrderError:"",timePriority:"alarm_on",productSelectionError:"production_quantity_limits",timesUp:"circle_notifications",documentScanner:"document_scanner",inventory:"inventory",qrCodeScanner:"qr_code_scanner",left_arrow:"chevron_left",right_arrow:"chevron_right"}}}]);